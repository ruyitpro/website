<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>First Ansible Playbook | Ruy IT Pro</title>
<meta name="keywords" content="Meraki, Ansible">
<meta name="description" content="Add a Syslog Server to all your Meraki MX devices using ANSIBLE. List all the MERAKI devices on your organization. (Or the ones you want to affect with this playbook)
One easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the List the Netowrks in an Organitation API call
GET {{baseUrl}}/organizations/:organizationId/networks This API call will return the list of all networks (in our cas all of them are MX devices).">
<meta name="author" content="">
<link rel="canonical" href="https://www.ruyitpro.com/post/firstansibleplaybook/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css" integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://www.ruyitpro.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.ruyitpro.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.ruyitpro.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.ruyitpro.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.ruyitpro.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="First Ansible Playbook" />
<meta property="og:description" content="Add a Syslog Server to all your Meraki MX devices using ANSIBLE. List all the MERAKI devices on your organization. (Or the ones you want to affect with this playbook)
One easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the List the Netowrks in an Organitation API call
GET {{baseUrl}}/organizations/:organizationId/networks This API call will return the list of all networks (in our cas all of them are MX devices)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ruyitpro.com/post/firstansibleplaybook/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-07-07T08:48:34-04:00" />
<meta property="article:modified_time" content="2023-07-07T08:48:34-04:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="First Ansible Playbook"/>
<meta name="twitter:description" content="Add a Syslog Server to all your Meraki MX devices using ANSIBLE. List all the MERAKI devices on your organization. (Or the ones you want to affect with this playbook)
One easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the List the Netowrks in an Organitation API call
GET {{baseUrl}}/organizations/:organizationId/networks This API call will return the list of all networks (in our cas all of them are MX devices)."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://www.ruyitpro.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "First Ansible Playbook",
      "item": "https://www.ruyitpro.com/post/firstansibleplaybook/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "First Ansible Playbook",
  "name": "First Ansible Playbook",
  "description": "Add a Syslog Server to all your Meraki MX devices using ANSIBLE. List all the MERAKI devices on your organization. (Or the ones you want to affect with this playbook)\nOne easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the List the Netowrks in an Organitation API call\nGET {{baseUrl}}/organizations/:organizationId/networks This API call will return the list of all networks (in our cas all of them are MX devices).",
  "keywords": [
    "Meraki", "Ansible"
  ],
  "articleBody": "Add a Syslog Server to all your Meraki MX devices using ANSIBLE. List all the MERAKI devices on your organization. (Or the ones you want to affect with this playbook)\nOne easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the List the Netowrks in an Organitation API call\nGET {{baseUrl}}/organizations/:organizationId/networks This API call will return the list of all networks (in our cas all of them are MX devices). We can use that information to feed an invetory file on ANSIBLE or we can use the directly as I did on this case.\nANSIBLE PLAYBOOK For this case I will be using the Meraki Syslog module. You see the documentation on this link.\nhttps://docs.ansible.com/ansible/latest/collections/cisco/meraki/meraki_syslog_module.html#ansible-collections-cisco-meraki-meraki-syslog-module\nThis is the actual YAML file that I used to change the SYSLOG servers on all my Merakidevices.\n--- - name: Query syslog configurations on network named MyNet in the YourOrg organization connection: local hosts: localhost #gather_facts: false tasks: - name: Syslog meraki_syslog: auth_key: xxxxxxx state: present org_id: 1234 net_id: \"{{ item }}\" servers: - host: 192.168.1.50 port: 514 roles: - Flows - URLs - Security Events - Appliance event log output_level: debug register: syslog_servers_1 loop: - L_123 - L_456 - L_0931 - L_03435 - L_43252 - L_2345 - L_1314 - L_134245 - L_123255 - L_1456 - L_12343256 - L_12345 - L_431245 - L_13245 - L_12325 - L_347645787 - L_2354236 - L_02375 - name: Debug debug: msg: \"{{ syslog_servers_1 }}\" delegate_to: localhost To run the playbook use the folowwing command:\nansible-playbook Meraki\\_filename.yaml This is probably the simplest way to use Ansiblle to do this. A cleaneer version would be to use an inventory file. This was actually my first Ansible Palybook so I will be making improvements and posting them here.\nThank you for reading\n",
  "wordCount" : "305",
  "inLanguage": "en",
  "datePublished": "2023-07-07T08:48:34-04:00",
  "dateModified": "2023-07-07T08:48:34-04:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.ruyitpro.com/post/firstansibleplaybook/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ruy IT Pro",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.ruyitpro.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.ruyitpro.com" accesskey="h" title="Ruy IT Pro (Alt + H)">Ruy IT Pro</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.ruyitpro.com/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://www.ruyitpro.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://www.ruyitpro.com/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://www.ruyitpro.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.ruyitpro.com">Home</a>&nbsp;»&nbsp;<a href="https://www.ruyitpro.com/post/">Posts</a></div>
    <h1 class="post-title">
      First Ansible Playbook
    </h1>
    <div class="post-meta"><span title='2023-07-07 08:48:34 -0400 CDT'>July 7, 2023</span>&nbsp;·&nbsp;2 min

</div>
  </header> 
  <div class="post-content"><h1 id="add-a-syslog-server-to-all-your-meraki-mx-devices-using-ansible">Add a Syslog Server to all your Meraki MX devices using ANSIBLE.<a hidden class="anchor" aria-hidden="true" href="#add-a-syslog-server-to-all-your-meraki-mx-devices-using-ansible">#</a></h1>
<h2 id="list-all-the-meraki-devices-on-your-organization">List all the MERAKI devices on your organization.<a hidden class="anchor" aria-hidden="true" href="#list-all-the-meraki-devices-on-your-organization">#</a></h2>
<p>(Or the ones you want to affect with this playbook)</p>
<hr>
<p>One easy way to do that is to use POSTMAN. We can take advantage of the MERAKI collection available. For this case we will use the <strong>List the Netowrks in an Organitation</strong> API call</p>
<pre tabindex="0"><code class="language-hhtps" data-lang="hhtps">
     GET {{baseUrl}}/organizations/:organizationId/networks
</code></pre><p>This API call will return the list of all networks (in our cas all of them are MX devices). We can use that information to feed an invetory file on ANSIBLE or we can use the directly as I did on this case.</p>
<h2 id="ansible-playbook">ANSIBLE PLAYBOOK<a hidden class="anchor" aria-hidden="true" href="#ansible-playbook">#</a></h2>
<p>For this case I will be using the Meraki Syslog module. You see the documentation on this link.</p>
<p><a href="https://docs.ansible.com/ansible/latest/collections/cisco/meraki/meraki_syslog_module.html#ansible-collections-cisco-meraki-meraki-syslog-module">https://docs.ansible.com/ansible/latest/collections/cisco/meraki/meraki_syslog_module.html#ansible-collections-cisco-meraki-meraki-syslog-module</a></p>
<p>This is the actual YAML file that I used to change the SYSLOG servers on all my Merakidevices.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>  ---
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Query syslog configurations on network named MyNet in the YourOrg organization</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">connection</span>: <span style="color:#ae81ff">local</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">localhost  </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#gather_facts: false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Syslog</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">meraki_syslog</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">auth_key</span>: <span style="color:#ae81ff">xxxxxxx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">state</span>: <span style="color:#ae81ff">present</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">org_id</span>: <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">net_id</span>: <span style="color:#e6db74">&#34;{{ item }}&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">servers</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">192.168.1.50</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>: <span style="color:#ae81ff">514</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">Flows</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">URLs</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">Security Events</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#ae81ff">Appliance event log</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">output_level</span>: <span style="color:#ae81ff">debug</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">register</span>: <span style="color:#ae81ff">syslog_servers_1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">loop</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_123</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_456</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_0931</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_03435</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_43252</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_2345</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_1314</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_134245</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_123255</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_1456</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_12343256</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_12345</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_431245</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_13245</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_12325</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_347645787</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_2354236</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">L_02375</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Debug</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">debug</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">msg</span>: <span style="color:#e6db74">&#34;{{ syslog_servers_1 }}&#34;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">delegate_to</span>: <span style="color:#ae81ff">localhost</span>
</span></span></code></pre></div><p>To run the playbook use the folowwing command:</p>
<pre tabindex="0"><code>  ansible-playbook Meraki\_filename.yaml
</code></pre><p>This is probably the simplest way to use Ansiblle to do this. A cleaneer version would be to use an inventory file. This was actually my first Ansible Palybook so I will be making improvements and posting them here.</p>
<p>Thank you for reading</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.ruyitpro.com/tags/meraki/">Meraki</a></li>
      <li><a href="https://www.ruyitpro.com/tags/ansible/">Ansible</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.ruyitpro.com/post/azurefundamentals/">
    <span class="title">« Prev</span>
    <br>
    <span>Azure Fundamentals</span>
  </a>
  <a class="next" href="https://www.ruyitpro.com/post/article2/">
    <span class="title">Next »</span>
    <br>
    <span>Reference Sites</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://www.ruyitpro.com">Ruy IT Pro</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
